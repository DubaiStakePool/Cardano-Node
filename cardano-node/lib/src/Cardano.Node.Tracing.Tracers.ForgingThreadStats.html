<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><link rel="stylesheet" type="text/css" href="style.css" /><script type="text/javascript" src="highlight.js"></script></head><body><pre><span class="hs-pragma">{-# LANGUAGE FlexibleInstances #-}</span><span>
</span><span id="line-2"></span><span class="hs-pragma">{-# LANGUAGE LambdaCase #-}</span><span>
</span><span id="line-3"></span><span class="hs-pragma">{-# LANGUAGE NamedFieldPuns #-}</span><span>
</span><span id="line-4"></span><span class="hs-pragma">{-# LANGUAGE RecordWildCards #-}</span><span>
</span><span id="line-5"></span><span>
</span><span id="line-6"></span><span class="hs-keyword">module</span><span> </span><span class="hs-identifier">Cardano.Node.Tracing.Tracers.ForgingThreadStats</span><span>
</span><span id="line-7"></span><span>    </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="Cardano.Node.Tracing.Tracers.ForgingThreadStats.html#ForgingStats"><span class="hs-identifier">ForgingStats</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-8"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Node.Tracing.Tracers.ForgingThreadStats.html#ForgeThreadStats"><span class="hs-identifier">ForgeThreadStats</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-9"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Cardano.Node.Tracing.Tracers.ForgingThreadStats.html#forgeThreadStats"><span class="hs-identifier">forgeThreadStats</span></a></span><span>
</span><span id="line-10"></span><span>  </span><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-11"></span><span>
</span><span id="line-12"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><span class="hs-identifier">Cardano.Logging</span></span><span>
</span><span id="line-13"></span><span>
</span><span id="line-14"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><a href="../file:///usr/local/.ghcup/ghc/9.2.7/share/doc/ghc-9.2.7/html/libraries/base-4.16.4.0/src"><span class="hs-identifier">Control.Concurrent</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../file:///usr/local/.ghcup/ghc/9.2.7/share/doc/ghc-9.2.7/html/libraries/base-4.16.4.0/src"><span class="hs-identifier">ThreadId</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../file:///usr/local/.ghcup/ghc/9.2.7/share/doc/ghc-9.2.7/html/libraries/base-4.16.4.0/src"><span class="hs-identifier">myThreadId</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-15"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><a href="../file:///usr/local/.ghcup/ghc/9.2.7/share/doc/ghc-9.2.7/html/libraries/base-4.16.4.0/src"><span class="hs-identifier">Control.Monad.IO.Class</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../file:///usr/local/.ghcup/ghc/9.2.7/share/doc/ghc-9.2.7/html/libraries/base-4.16.4.0/src"><span class="hs-identifier">MonadIO</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-16"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><span class="hs-identifier">Data.Aeson</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">Value</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-operator">(.=)</span></span><span class="hs-special">)</span><span>
</span><span id="line-17"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><a href="../file:///usr/local/.ghcup/ghc/9.2.7/share/doc/ghc-9.2.7/html/libraries/containers-0.6.5.1/src"><span class="hs-identifier">Data.Map.Strict</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../file:///usr/local/.ghcup/ghc/9.2.7/share/doc/ghc-9.2.7/html/libraries/containers-0.6.5.1/src"><span class="hs-identifier">Map</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-18"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="../file:///usr/local/.ghcup/ghc/9.2.7/share/doc/ghc-9.2.7/html/libraries/containers-0.6.5.1/src"><span class="hs-identifier">Data.Map.Strict</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Map</span></span><span>
</span><span id="line-19"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><a href="../file:///usr/local/.ghcup/ghc/9.2.7/share/doc/ghc-9.2.7/html/libraries/base-4.16.4.0/src"><span class="hs-identifier">Data.Maybe</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../file:///usr/local/.ghcup/ghc/9.2.7/share/doc/ghc-9.2.7/html/libraries/base-4.16.4.0/src"><span class="hs-identifier">fromMaybe</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-20"></span><span>
</span><span id="line-21"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><a href="Cardano.Node.Tracing.Tracers.StartLeadershipCheck.html"><span class="hs-identifier">Cardano.Node.Tracing.Tracers.StartLeadershipCheck</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Node.Tracing.Tracers.StartLeadershipCheck.html#ForgeTracerType"><span class="hs-identifier">ForgeTracerType</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-22"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><span class="hs-identifier">Cardano.Slotting.Slot</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">SlotNo</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-23"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><span class="hs-identifier">Ouroboros.Consensus.Node.Tracers</span></span><span>
</span><span id="line-24"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Ouroboros.Consensus.Node.Tracers</span></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Consensus</span></span><span>
</span><span id="line-25"></span><span class="hs-keyword">import</span><span>           </span><span class="annot"><span class="hs-identifier">Ouroboros.Consensus.Shelley.Node</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-26"></span><span>
</span><span id="line-27"></span><span class="hs-comment">--------------------------------------------------------------------------------</span><span>
</span><span id="line-28"></span><span class="hs-comment">-- ForgeThreadStats Tracer</span><span>
</span><span id="line-29"></span><span class="hs-comment">--------------------------------------------------------------------------------</span><span>
</span><span id="line-30"></span><span>
</span><span id="line-31"></span><span class="hs-comment">-- | Per-forging-thread statistics.</span><span>
</span><span id="line-32"></span><span class="hs-keyword">data</span><span> </span><span id="ForgeThreadStats"><span class="annot"><a href="Cardano.Node.Tracing.Tracers.ForgingThreadStats.html#ForgeThreadStats"><span class="hs-identifier hs-var">ForgeThreadStats</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="ForgeThreadStats"><span class="annot"><a href="Cardano.Node.Tracing.Tracers.ForgingThreadStats.html#ForgeThreadStats"><span class="hs-identifier hs-var">ForgeThreadStats</span></a></span></span><span>
</span><span id="line-33"></span><span>  </span><span class="hs-special">{</span><span> </span><span id="ftsNodeCannotForgeNum"><span class="annot"><span class="annottext">ForgeThreadStats -&gt; Int
</span><a href="Cardano.Node.Tracing.Tracers.ForgingThreadStats.html#ftsNodeCannotForgeNum"><span class="hs-identifier hs-var hs-var">ftsNodeCannotForgeNum</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><span class="annot"><a href="../file:///usr/local/.ghcup/ghc/9.2.7/share/doc/ghc-9.2.7/html/libraries/ghc-prim-0.8.0/src"><span class="hs-identifier hs-type">Int</span></a></span><span>
</span><span id="line-34"></span><span>  </span><span class="hs-special">,</span><span> </span><span id="ftsNodeIsLeaderNum"><span class="annot"><span class="annottext">ForgeThreadStats -&gt; Int
</span><a href="Cardano.Node.Tracing.Tracers.ForgingThreadStats.html#ftsNodeIsLeaderNum"><span class="hs-identifier hs-var hs-var">ftsNodeIsLeaderNum</span></a></span></span><span>    </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><span class="annot"><a href="../file:///usr/local/.ghcup/ghc/9.2.7/share/doc/ghc-9.2.7/html/libraries/ghc-prim-0.8.0/src"><span class="hs-identifier hs-type">Int</span></a></span><span>
</span><span id="line-35"></span><span>  </span><span class="hs-special">,</span><span> </span><span id="ftsBlocksForgedNum"><span class="annot"><span class="annottext">ForgeThreadStats -&gt; Int
</span><a href="Cardano.Node.Tracing.Tracers.ForgingThreadStats.html#ftsBlocksForgedNum"><span class="hs-identifier hs-var hs-var">ftsBlocksForgedNum</span></a></span></span><span>    </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><span class="annot"><a href="../file:///usr/local/.ghcup/ghc/9.2.7/share/doc/ghc-9.2.7/html/libraries/ghc-prim-0.8.0/src"><span class="hs-identifier hs-type">Int</span></a></span><span>
</span><span id="line-36"></span><span>  </span><span class="hs-special">,</span><span> </span><span id="ftsSlotsMissedNum"><span class="annot"><span class="annottext">ForgeThreadStats -&gt; Int
</span><a href="Cardano.Node.Tracing.Tracers.ForgingThreadStats.html#ftsSlotsMissedNum"><span class="hs-identifier hs-var hs-var">ftsSlotsMissedNum</span></a></span></span><span>     </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><span class="annot"><a href="../file:///usr/local/.ghcup/ghc/9.2.7/share/doc/ghc-9.2.7/html/libraries/ghc-prim-0.8.0/src"><span class="hs-identifier hs-type">Int</span></a></span><span>
</span><span id="line-37"></span><span>    </span><span class="hs-comment">-- ^ Potentially missed slots.  Note that this is not the same as the number</span><span>
</span><span id="line-38"></span><span>    </span><span class="hs-comment">-- of missed blocks, since this includes all occurrences of not reaching a</span><span>
</span><span id="line-39"></span><span>    </span><span class="hs-comment">-- leadership check decision, whether or not leadership was possible or not.</span><span>
</span><span id="line-40"></span><span>    </span><span class="hs-comment">--</span><span>
</span><span id="line-41"></span><span>    </span><span class="hs-comment">-- Also note that when the aggregate total for this metric is reported in the</span><span>
</span><span id="line-42"></span><span>    </span><span class="hs-comment">-- multi-pool case, it can be much larger than the actual number of slots</span><span>
</span><span id="line-43"></span><span>    </span><span class="hs-comment">-- occurring since node start, for it is a sum total for all threads.</span><span>
</span><span id="line-44"></span><span>  </span><span class="hs-special">,</span><span> </span><span id="ftsLastSlot"><span class="annot"><span class="annottext">ForgeThreadStats -&gt; Int
</span><a href="Cardano.Node.Tracing.Tracers.ForgingThreadStats.html#ftsLastSlot"><span class="hs-identifier hs-var hs-var">ftsLastSlot</span></a></span></span><span>           </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><span class="annot"><a href="../file:///usr/local/.ghcup/ghc/9.2.7/share/doc/ghc-9.2.7/html/libraries/ghc-prim-0.8.0/src"><span class="hs-identifier hs-type">Int</span></a></span><span>
</span><span id="line-45"></span><span>  </span><span class="hs-special">}</span><span>
</span><span id="line-46"></span><span>
</span><span id="line-47"></span><span class="hs-keyword">instance</span><span> </span><span class="annot"><span class="hs-identifier hs-type">LogFormatting</span></span><span> </span><span class="annot"><a href="Cardano.Node.Tracing.Tracers.ForgingThreadStats.html#ForgeThreadStats"><span class="hs-identifier hs-type">ForgeThreadStats</span></a></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-48"></span><span>  </span><span id="local-6989586621679612584"><span class="annot"><span class="annottext">forHuman :: ForgeThreadStats -&gt; Text
</span><span class="hs-identifier hs-var hs-var hs-var hs-var">forHuman</span></span></span><span> </span><span class="annot"><a href="Cardano.Node.Tracing.Tracers.ForgingThreadStats.html#ForgeThreadStats"><span class="hs-identifier hs-type">ForgeThreadStats</span></a></span><span> </span><span class="hs-special">{</span><span id="local-6989586621679612578"><span id="local-6989586621679612579"><span id="local-6989586621679612580"><span id="local-6989586621679612581"><span id="local-6989586621679612582"><span class="annot"><span class="annottext">Int
ftsLastSlot :: Int
ftsSlotsMissedNum :: Int
ftsBlocksForgedNum :: Int
ftsNodeIsLeaderNum :: Int
ftsNodeCannotForgeNum :: Int
ftsLastSlot :: ForgeThreadStats -&gt; Int
ftsSlotsMissedNum :: ForgeThreadStats -&gt; Int
ftsBlocksForgedNum :: ForgeThreadStats -&gt; Int
ftsNodeIsLeaderNum :: ForgeThreadStats -&gt; Int
ftsNodeCannotForgeNum :: ForgeThreadStats -&gt; Int
</span><a href="#local-6989586621679612578"><span class="hs-glyph hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">..</span></a></span></span></span></span></span></span><span class="hs-special">}</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-49"></span><span>    </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;Node cannot forge &quot;</span></span><span>  </span><span class="annot"><span class="annottext">forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><a href="../file:///usr/local/.ghcup/ghc/9.2.7/share/doc/ghc-9.2.7/html/libraries/base-4.16.4.0/src"><span class="hs-operator hs-var">&lt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Show a =&gt; a -&gt; Text
</span><span class="hs-identifier hs-var">showT</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679612582"><span class="hs-identifier hs-var">ftsNodeCannotForgeNum</span></a></span><span>
</span><span id="line-50"></span><span>    </span><span class="annot"><span class="annottext">forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><a href="../file:///usr/local/.ghcup/ghc/9.2.7/share/doc/ghc-9.2.7/html/libraries/base-4.16.4.0/src"><span class="hs-operator hs-var">&lt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot; node is leader &quot;</span></span><span> </span><span class="annot"><span class="annottext">forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><a href="../file:///usr/local/.ghcup/ghc/9.2.7/share/doc/ghc-9.2.7/html/libraries/base-4.16.4.0/src"><span class="hs-operator hs-var">&lt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Show a =&gt; a -&gt; Text
</span><span class="hs-identifier hs-var">showT</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679612581"><span class="hs-identifier hs-var">ftsNodeIsLeaderNum</span></a></span><span>
</span><span id="line-51"></span><span>    </span><span class="annot"><span class="annottext">forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><a href="../file:///usr/local/.ghcup/ghc/9.2.7/share/doc/ghc-9.2.7/html/libraries/base-4.16.4.0/src"><span class="hs-operator hs-var">&lt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot; blocks forged &quot;</span></span><span>  </span><span class="annot"><span class="annottext">forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><a href="../file:///usr/local/.ghcup/ghc/9.2.7/share/doc/ghc-9.2.7/html/libraries/base-4.16.4.0/src"><span class="hs-operator hs-var">&lt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Show a =&gt; a -&gt; Text
</span><span class="hs-identifier hs-var">showT</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679612580"><span class="hs-identifier hs-var">ftsBlocksForgedNum</span></a></span><span>
</span><span id="line-52"></span><span>    </span><span class="annot"><span class="annottext">forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><a href="../file:///usr/local/.ghcup/ghc/9.2.7/share/doc/ghc-9.2.7/html/libraries/base-4.16.4.0/src"><span class="hs-operator hs-var">&lt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot; slots missed &quot;</span></span><span>   </span><span class="annot"><span class="annottext">forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><a href="../file:///usr/local/.ghcup/ghc/9.2.7/share/doc/ghc-9.2.7/html/libraries/base-4.16.4.0/src"><span class="hs-operator hs-var">&lt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Show a =&gt; a -&gt; Text
</span><span class="hs-identifier hs-var">showT</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679612579"><span class="hs-identifier hs-var">ftsSlotsMissedNum</span></a></span><span>
</span><span id="line-53"></span><span>    </span><span class="annot"><span class="annottext">forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><a href="../file:///usr/local/.ghcup/ghc/9.2.7/share/doc/ghc-9.2.7/html/libraries/base-4.16.4.0/src"><span class="hs-operator hs-var">&lt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot; last slot &quot;</span></span><span>      </span><span class="annot"><span class="annottext">forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><a href="../file:///usr/local/.ghcup/ghc/9.2.7/share/doc/ghc-9.2.7/html/libraries/base-4.16.4.0/src"><span class="hs-operator hs-var">&lt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Show a =&gt; a -&gt; Text
</span><span class="hs-identifier hs-var">showT</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679612578"><span class="hs-identifier hs-var">ftsLastSlot</span></a></span><span>
</span><span id="line-54"></span><span>  </span><span id="local-6989586621679612546"><span class="annot"><span class="annottext">forMachine :: DetailLevel -&gt; ForgeThreadStats -&gt; Object
</span><span class="hs-identifier hs-var hs-var hs-var hs-var">forMachine</span></span></span><span> </span><span id="local-6989586621679612544"><span class="annot"><span class="annottext">DetailLevel
</span><a href="#local-6989586621679612544"><span class="hs-identifier hs-var">_dtal</span></a></span></span><span> </span><span class="annot"><a href="Cardano.Node.Tracing.Tracers.ForgingThreadStats.html#ForgeThreadStats"><span class="hs-identifier hs-type">ForgeThreadStats</span></a></span><span> </span><span class="hs-special">{</span><span id="local-6989586621679612539"><span id="local-6989586621679612540"><span id="local-6989586621679612541"><span id="local-6989586621679612542"><span id="local-6989586621679612543"><span class="annot"><span class="annottext">Int
ftsLastSlot :: Int
ftsSlotsMissedNum :: Int
ftsBlocksForgedNum :: Int
ftsNodeIsLeaderNum :: Int
ftsNodeCannotForgeNum :: Int
ftsLastSlot :: ForgeThreadStats -&gt; Int
ftsSlotsMissedNum :: ForgeThreadStats -&gt; Int
ftsBlocksForgedNum :: ForgeThreadStats -&gt; Int
ftsNodeIsLeaderNum :: ForgeThreadStats -&gt; Int
ftsNodeCannotForgeNum :: ForgeThreadStats -&gt; Int
</span><a href="#local-6989586621679612539"><span class="hs-glyph hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">..</span></a></span></span></span></span></span></span><span class="hs-special">}</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-55"></span><span>    </span><span class="annot"><span class="annottext">forall a. Monoid a =&gt; [a] -&gt; a
</span><a href="../file:///usr/local/.ghcup/ghc/9.2.7/share/doc/ghc-9.2.7/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-var">mconcat</span></a></span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Key
</span><span class="hs-string">&quot;kind&quot;</span></span><span> </span><span class="annot"><span class="annottext">forall kv v. (KeyValue kv, ToJSON v) =&gt; Key -&gt; v -&gt; kv
</span><span class="hs-operator hs-var">.=</span></span><span> </span><span class="annot"><span class="annottext">Text -&gt; Value
</span><span class="hs-identifier hs-var">String</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;ForgeThreadStats&quot;</span></span><span>
</span><span id="line-56"></span><span>             </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Key
</span><span class="hs-string">&quot;nodeCannotForgeNum&quot;</span></span><span> </span><span class="annot"><span class="annottext">forall kv v. (KeyValue kv, ToJSON v) =&gt; Key -&gt; v -&gt; kv
</span><span class="hs-operator hs-var">.=</span></span><span> </span><span class="annot"><span class="annottext">Text -&gt; Value
</span><span class="hs-identifier hs-var">String</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a. Show a =&gt; a -&gt; Text
</span><span class="hs-identifier hs-var">showT</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679612543"><span class="hs-identifier hs-var">ftsNodeCannotForgeNum</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-57"></span><span>             </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Key
</span><span class="hs-string">&quot;nodeIsLeaderNum&quot;</span></span><span>    </span><span class="annot"><span class="annottext">forall kv v. (KeyValue kv, ToJSON v) =&gt; Key -&gt; v -&gt; kv
</span><span class="hs-operator hs-var">.=</span></span><span> </span><span class="annot"><span class="annottext">Text -&gt; Value
</span><span class="hs-identifier hs-var">String</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a. Show a =&gt; a -&gt; Text
</span><span class="hs-identifier hs-var">showT</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679612542"><span class="hs-identifier hs-var">ftsNodeIsLeaderNum</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-58"></span><span>             </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Key
</span><span class="hs-string">&quot;blocksForgedNum&quot;</span></span><span>    </span><span class="annot"><span class="annottext">forall kv v. (KeyValue kv, ToJSON v) =&gt; Key -&gt; v -&gt; kv
</span><span class="hs-operator hs-var">.=</span></span><span> </span><span class="annot"><span class="annottext">Text -&gt; Value
</span><span class="hs-identifier hs-var">String</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a. Show a =&gt; a -&gt; Text
</span><span class="hs-identifier hs-var">showT</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679612541"><span class="hs-identifier hs-var">ftsBlocksForgedNum</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-59"></span><span>             </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Key
</span><span class="hs-string">&quot;slotsMissed&quot;</span></span><span>        </span><span class="annot"><span class="annottext">forall kv v. (KeyValue kv, ToJSON v) =&gt; Key -&gt; v -&gt; kv
</span><span class="hs-operator hs-var">.=</span></span><span> </span><span class="annot"><span class="annottext">Text -&gt; Value
</span><span class="hs-identifier hs-var">String</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a. Show a =&gt; a -&gt; Text
</span><span class="hs-identifier hs-var">showT</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679612540"><span class="hs-identifier hs-var">ftsSlotsMissedNum</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-60"></span><span>             </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Key
</span><span class="hs-string">&quot;lastSlot&quot;</span></span><span>           </span><span class="annot"><span class="annottext">forall kv v. (KeyValue kv, ToJSON v) =&gt; Key -&gt; v -&gt; kv
</span><span class="hs-operator hs-var">.=</span></span><span> </span><span class="annot"><span class="annottext">Text -&gt; Value
</span><span class="hs-identifier hs-var">String</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a. Show a =&gt; a -&gt; Text
</span><span class="hs-identifier hs-var">showT</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679612539"><span class="hs-identifier hs-var">ftsLastSlot</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-61"></span><span>             </span><span class="hs-special">]</span><span>
</span><span id="line-62"></span><span>  </span><span id="local-6989586621679612520"><span class="annot"><span class="annottext">asMetrics :: ForgeThreadStats -&gt; [Metric]
</span><span class="hs-identifier hs-var hs-var hs-var hs-var">asMetrics</span></span></span><span> </span><span class="annot"><a href="Cardano.Node.Tracing.Tracers.ForgingThreadStats.html#ForgeThreadStats"><span class="hs-identifier hs-type">ForgeThreadStats</span></a></span><span> </span><span class="hs-special">{</span><span id="local-6989586621679612514"><span id="local-6989586621679612515"><span id="local-6989586621679612516"><span id="local-6989586621679612517"><span id="local-6989586621679612518"><span class="annot"><span class="annottext">Int
ftsLastSlot :: Int
ftsSlotsMissedNum :: Int
ftsBlocksForgedNum :: Int
ftsNodeIsLeaderNum :: Int
ftsNodeCannotForgeNum :: Int
ftsLastSlot :: ForgeThreadStats -&gt; Int
ftsSlotsMissedNum :: ForgeThreadStats -&gt; Int
ftsBlocksForgedNum :: ForgeThreadStats -&gt; Int
ftsNodeIsLeaderNum :: ForgeThreadStats -&gt; Int
ftsNodeCannotForgeNum :: ForgeThreadStats -&gt; Int
</span><a href="#local-6989586621679612514"><span class="hs-glyph hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">..</span></a></span></span></span></span></span></span><span class="hs-special">}</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-63"></span><span>    </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Text -&gt; Integer -&gt; Metric
</span><span class="hs-identifier hs-var">IntM</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;Forge.NodeCannotForgeNum&quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a b. (Integral a, Num b) =&gt; a -&gt; b
</span><a href="../file:///usr/local/.ghcup/ghc/9.2.7/share/doc/ghc-9.2.7/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-var">fromIntegral</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679612518"><span class="hs-identifier hs-var">ftsNodeCannotForgeNum</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-64"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Text -&gt; Integer -&gt; Metric
</span><span class="hs-identifier hs-var">IntM</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;Forge.NodeIsLeaderNum&quot;</span></span><span>    </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a b. (Integral a, Num b) =&gt; a -&gt; b
</span><a href="../file:///usr/local/.ghcup/ghc/9.2.7/share/doc/ghc-9.2.7/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-var">fromIntegral</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679612517"><span class="hs-identifier hs-var">ftsNodeIsLeaderNum</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-65"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Text -&gt; Integer -&gt; Metric
</span><span class="hs-identifier hs-var">IntM</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;Forge.BlocksForgedNum&quot;</span></span><span>    </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a b. (Integral a, Num b) =&gt; a -&gt; b
</span><a href="../file:///usr/local/.ghcup/ghc/9.2.7/share/doc/ghc-9.2.7/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-var">fromIntegral</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679612516"><span class="hs-identifier hs-var">ftsBlocksForgedNum</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-66"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Text -&gt; Integer -&gt; Metric
</span><span class="hs-identifier hs-var">IntM</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;Forge.SlotsMissed&quot;</span></span><span>        </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a b. (Integral a, Num b) =&gt; a -&gt; b
</span><a href="../file:///usr/local/.ghcup/ghc/9.2.7/share/doc/ghc-9.2.7/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-var">fromIntegral</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679612515"><span class="hs-identifier hs-var">ftsSlotsMissedNum</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-67"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Text -&gt; Integer -&gt; Metric
</span><span class="hs-identifier hs-var">IntM</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;Forge.LastSlot&quot;</span></span><span>           </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a b. (Integral a, Num b) =&gt; a -&gt; b
</span><a href="../file:///usr/local/.ghcup/ghc/9.2.7/share/doc/ghc-9.2.7/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-var">fromIntegral</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679612514"><span class="hs-identifier hs-var">ftsLastSlot</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-68"></span><span>    </span><span class="hs-special">]</span><span>
</span><span id="line-69"></span><span>
</span><span id="line-70"></span><span>
</span><span id="line-71"></span><span class="annot"><a href="Cardano.Node.Tracing.Tracers.ForgingThreadStats.html#emptyForgeThreadStats"><span class="hs-identifier hs-type">emptyForgeThreadStats</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Cardano.Node.Tracing.Tracers.ForgingThreadStats.html#ForgeThreadStats"><span class="hs-identifier hs-type">ForgeThreadStats</span></a></span><span>
</span><span id="line-72"></span><span id="emptyForgeThreadStats"><span class="annot"><span class="annottext">emptyForgeThreadStats :: ForgeThreadStats
</span><a href="Cardano.Node.Tracing.Tracers.ForgingThreadStats.html#emptyForgeThreadStats"><span class="hs-identifier hs-var hs-var">emptyForgeThreadStats</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int -&gt; Int -&gt; Int -&gt; ForgeThreadStats
</span><a href="Cardano.Node.Tracing.Tracers.ForgingThreadStats.html#ForgeThreadStats"><span class="hs-identifier hs-var">ForgeThreadStats</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span>
</span><span id="line-73"></span><span>
</span><span id="line-74"></span><span>
</span><span id="line-75"></span><span class="hs-comment">--------------------------------------------------------------------------------</span><span>
</span><span id="line-76"></span><span class="hs-comment">-- ForgingStats Tracer</span><span>
</span><span id="line-77"></span><span class="hs-comment">--------------------------------------------------------------------------------</span><span>
</span><span id="line-78"></span><span>
</span><span id="line-79"></span><span class="hs-comment">-- | This structure stores counters of blockchain-related events,</span><span>
</span><span id="line-80"></span><span class="hs-comment">--   per individual thread in fsStats.</span><span>
</span><span id="line-81"></span><span class="hs-keyword">data</span><span> </span><span id="ForgingStats"><span class="annot"><a href="Cardano.Node.Tracing.Tracers.ForgingThreadStats.html#ForgingStats"><span class="hs-identifier hs-var">ForgingStats</span></a></span></span><span>
</span><span id="line-82"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span id="ForgingStats"><span class="annot"><a href="Cardano.Node.Tracing.Tracers.ForgingThreadStats.html#ForgingStats"><span class="hs-identifier hs-var">ForgingStats</span></a></span></span><span>
</span><span id="line-83"></span><span>  </span><span class="hs-special">{</span><span> </span><span id="fsStats"><span class="annot"><span class="annottext">ForgingStats -&gt; Map ThreadId ForgeThreadStats
</span><a href="Cardano.Node.Tracing.Tracers.ForgingThreadStats.html#fsStats"><span class="hs-identifier hs-var hs-var">fsStats</span></a></span></span><span>              </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><span class="hs-special">(</span><span class="annot"><a href="../file:///usr/local/.ghcup/ghc/9.2.7/share/doc/ghc-9.2.7/html/libraries/containers-0.6.5.1/src"><span class="hs-identifier hs-type">Map</span></a></span><span> </span><span class="annot"><a href="../file:///usr/local/.ghcup/ghc/9.2.7/share/doc/ghc-9.2.7/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-type">ThreadId</span></a></span><span> </span><span class="annot"><a href="Cardano.Node.Tracing.Tracers.ForgingThreadStats.html#ForgeThreadStats"><span class="hs-identifier hs-type">ForgeThreadStats</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-84"></span><span>  </span><span class="hs-special">,</span><span> </span><span id="fsNodeCannotForgeNum"><span class="annot"><span class="annottext">ForgingStats -&gt; Int
</span><a href="Cardano.Node.Tracing.Tracers.ForgingThreadStats.html#fsNodeCannotForgeNum"><span class="hs-identifier hs-var hs-var">fsNodeCannotForgeNum</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><span class="annot"><a href="../file:///usr/local/.ghcup/ghc/9.2.7/share/doc/ghc-9.2.7/html/libraries/ghc-prim-0.8.0/src"><span class="hs-identifier hs-type">Int</span></a></span><span>
</span><span id="line-85"></span><span>  </span><span class="hs-special">,</span><span> </span><span id="fsNodeIsLeaderNum"><span class="annot"><span class="annottext">ForgingStats -&gt; Int
</span><a href="Cardano.Node.Tracing.Tracers.ForgingThreadStats.html#fsNodeIsLeaderNum"><span class="hs-identifier hs-var hs-var">fsNodeIsLeaderNum</span></a></span></span><span>    </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><span class="annot"><a href="../file:///usr/local/.ghcup/ghc/9.2.7/share/doc/ghc-9.2.7/html/libraries/ghc-prim-0.8.0/src"><span class="hs-identifier hs-type">Int</span></a></span><span>
</span><span id="line-86"></span><span>  </span><span class="hs-special">,</span><span> </span><span id="fsBlocksForgedNum"><span class="annot"><span class="annottext">ForgingStats -&gt; Int
</span><a href="Cardano.Node.Tracing.Tracers.ForgingThreadStats.html#fsBlocksForgedNum"><span class="hs-identifier hs-var hs-var">fsBlocksForgedNum</span></a></span></span><span>    </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><span class="annot"><a href="../file:///usr/local/.ghcup/ghc/9.2.7/share/doc/ghc-9.2.7/html/libraries/ghc-prim-0.8.0/src"><span class="hs-identifier hs-type">Int</span></a></span><span>
</span><span id="line-87"></span><span>  </span><span class="hs-special">,</span><span> </span><span id="fsSlotsMissedNum"><span class="annot"><span class="annottext">ForgingStats -&gt; Int
</span><a href="Cardano.Node.Tracing.Tracers.ForgingThreadStats.html#fsSlotsMissedNum"><span class="hs-identifier hs-var hs-var">fsSlotsMissedNum</span></a></span></span><span>     </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><span class="annot"><a href="../file:///usr/local/.ghcup/ghc/9.2.7/share/doc/ghc-9.2.7/html/libraries/ghc-prim-0.8.0/src"><span class="hs-identifier hs-type">Int</span></a></span><span>
</span><span id="line-88"></span><span>  </span><span class="hs-special">}</span><span>
</span><span id="line-89"></span><span>
</span><span id="line-90"></span><span class="hs-keyword">instance</span><span> </span><span class="annot"><span class="hs-identifier hs-type">LogFormatting</span></span><span> </span><span class="annot"><a href="Cardano.Node.Tracing.Tracers.ForgingThreadStats.html#ForgingStats"><span class="hs-identifier hs-type">ForgingStats</span></a></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-91"></span><span>  </span><span id="local-6989586621679612486"><span class="annot"><span class="annottext">forHuman :: ForgingStats -&gt; Text
</span><a href="#local-6989586621679612486"><span class="hs-identifier hs-var hs-var hs-var hs-var">forHuman</span></a></span></span><span> </span><span class="annot"><a href="Cardano.Node.Tracing.Tracers.ForgingThreadStats.html#ForgingStats"><span class="hs-identifier hs-type">ForgingStats</span></a></span><span> </span><span class="hs-special">{</span><span id="local-6989586621679612481"><span id="local-6989586621679612482"><span id="local-6989586621679612483"><span id="local-6989586621679612484"><span id="local-6989586621679612485"><span class="annot"><span class="annottext">Int
Map ThreadId ForgeThreadStats
fsSlotsMissedNum :: Int
fsBlocksForgedNum :: Int
fsNodeIsLeaderNum :: Int
fsNodeCannotForgeNum :: Int
fsStats :: Map ThreadId ForgeThreadStats
fsSlotsMissedNum :: ForgingStats -&gt; Int
fsBlocksForgedNum :: ForgingStats -&gt; Int
fsNodeIsLeaderNum :: ForgingStats -&gt; Int
fsNodeCannotForgeNum :: ForgingStats -&gt; Int
fsStats :: ForgingStats -&gt; Map ThreadId ForgeThreadStats
</span><a href="#local-6989586621679612481"><span class="hs-glyph hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">..</span></a></span></span></span></span></span></span><span class="hs-special">}</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-92"></span><span>    </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;Node cannot forge &quot;</span></span><span>  </span><span class="annot"><span class="annottext">forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><a href="../file:///usr/local/.ghcup/ghc/9.2.7/share/doc/ghc-9.2.7/html/libraries/base-4.16.4.0/src"><span class="hs-operator hs-var">&lt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Show a =&gt; a -&gt; Text
</span><span class="hs-identifier hs-var">showT</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679612484"><span class="hs-identifier hs-var">fsNodeCannotForgeNum</span></a></span><span>
</span><span id="line-93"></span><span>    </span><span class="annot"><span class="annottext">forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><a href="../file:///usr/local/.ghcup/ghc/9.2.7/share/doc/ghc-9.2.7/html/libraries/base-4.16.4.0/src"><span class="hs-operator hs-var">&lt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot; node is leader &quot;</span></span><span> </span><span class="annot"><span class="annottext">forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><a href="../file:///usr/local/.ghcup/ghc/9.2.7/share/doc/ghc-9.2.7/html/libraries/base-4.16.4.0/src"><span class="hs-operator hs-var">&lt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Show a =&gt; a -&gt; Text
</span><span class="hs-identifier hs-var">showT</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679612483"><span class="hs-identifier hs-var">fsNodeIsLeaderNum</span></a></span><span>
</span><span id="line-94"></span><span>    </span><span class="annot"><span class="annottext">forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><a href="../file:///usr/local/.ghcup/ghc/9.2.7/share/doc/ghc-9.2.7/html/libraries/base-4.16.4.0/src"><span class="hs-operator hs-var">&lt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot; blocks forged &quot;</span></span><span>  </span><span class="annot"><span class="annottext">forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><a href="../file:///usr/local/.ghcup/ghc/9.2.7/share/doc/ghc-9.2.7/html/libraries/base-4.16.4.0/src"><span class="hs-operator hs-var">&lt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Show a =&gt; a -&gt; Text
</span><span class="hs-identifier hs-var">showT</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679612482"><span class="hs-identifier hs-var">fsBlocksForgedNum</span></a></span><span>
</span><span id="line-95"></span><span>    </span><span class="annot"><span class="annottext">forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><a href="../file:///usr/local/.ghcup/ghc/9.2.7/share/doc/ghc-9.2.7/html/libraries/base-4.16.4.0/src"><span class="hs-operator hs-var">&lt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot; slots missed &quot;</span></span><span>   </span><span class="annot"><span class="annottext">forall a. Semigroup a =&gt; a -&gt; a -&gt; a
</span><a href="../file:///usr/local/.ghcup/ghc/9.2.7/share/doc/ghc-9.2.7/html/libraries/base-4.16.4.0/src"><span class="hs-operator hs-var">&lt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Show a =&gt; a -&gt; Text
</span><span class="hs-identifier hs-var">showT</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679612481"><span class="hs-identifier hs-var">fsSlotsMissedNum</span></a></span><span>
</span><span id="line-96"></span><span>  </span><span id="local-6989586621679612458"><span class="annot"><span class="annottext">forMachine :: DetailLevel -&gt; ForgingStats -&gt; Object
</span><a href="#local-6989586621679612458"><span class="hs-identifier hs-var hs-var hs-var hs-var">forMachine</span></a></span></span><span> </span><span id="local-6989586621679612457"><span class="annot"><span class="annottext">DetailLevel
</span><a href="#local-6989586621679612457"><span class="hs-identifier hs-var">_dtal</span></a></span></span><span> </span><span class="annot"><a href="Cardano.Node.Tracing.Tracers.ForgingThreadStats.html#ForgingStats"><span class="hs-identifier hs-type">ForgingStats</span></a></span><span> </span><span class="hs-special">{</span><span id="local-6989586621679612452"><span id="local-6989586621679612453"><span id="local-6989586621679612454"><span id="local-6989586621679612455"><span id="local-6989586621679612456"><span class="annot"><span class="annottext">Int
Map ThreadId ForgeThreadStats
fsSlotsMissedNum :: Int
fsBlocksForgedNum :: Int
fsNodeIsLeaderNum :: Int
fsNodeCannotForgeNum :: Int
fsStats :: Map ThreadId ForgeThreadStats
fsSlotsMissedNum :: ForgingStats -&gt; Int
fsBlocksForgedNum :: ForgingStats -&gt; Int
fsNodeIsLeaderNum :: ForgingStats -&gt; Int
fsNodeCannotForgeNum :: ForgingStats -&gt; Int
fsStats :: ForgingStats -&gt; Map ThreadId ForgeThreadStats
</span><a href="#local-6989586621679612452"><span class="hs-glyph hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">..</span></a></span></span></span></span></span></span><span class="hs-special">}</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-97"></span><span>    </span><span class="annot"><span class="annottext">forall a. Monoid a =&gt; [a] -&gt; a
</span><a href="../file:///usr/local/.ghcup/ghc/9.2.7/share/doc/ghc-9.2.7/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-var">mconcat</span></a></span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Key
</span><span class="hs-string">&quot;kind&quot;</span></span><span> </span><span class="annot"><span class="annottext">forall kv v. (KeyValue kv, ToJSON v) =&gt; Key -&gt; v -&gt; kv
</span><span class="hs-operator hs-var">.=</span></span><span> </span><span class="annot"><span class="annottext">Text -&gt; Value
</span><span class="hs-identifier hs-var">String</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;ForgingStats&quot;</span></span><span>
</span><span id="line-98"></span><span>             </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Key
</span><span class="hs-string">&quot;nodeCannotForgeNum&quot;</span></span><span> </span><span class="annot"><span class="annottext">forall kv v. (KeyValue kv, ToJSON v) =&gt; Key -&gt; v -&gt; kv
</span><span class="hs-operator hs-var">.=</span></span><span> </span><span class="annot"><span class="annottext">Text -&gt; Value
</span><span class="hs-identifier hs-var">String</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a. Show a =&gt; a -&gt; Text
</span><span class="hs-identifier hs-var">showT</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679612455"><span class="hs-identifier hs-var">fsNodeCannotForgeNum</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-99"></span><span>             </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Key
</span><span class="hs-string">&quot;nodeIsLeaderNum&quot;</span></span><span>    </span><span class="annot"><span class="annottext">forall kv v. (KeyValue kv, ToJSON v) =&gt; Key -&gt; v -&gt; kv
</span><span class="hs-operator hs-var">.=</span></span><span> </span><span class="annot"><span class="annottext">Text -&gt; Value
</span><span class="hs-identifier hs-var">String</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a. Show a =&gt; a -&gt; Text
</span><span class="hs-identifier hs-var">showT</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679612454"><span class="hs-identifier hs-var">fsNodeIsLeaderNum</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-100"></span><span>             </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Key
</span><span class="hs-string">&quot;blocksForgedNum&quot;</span></span><span>    </span><span class="annot"><span class="annottext">forall kv v. (KeyValue kv, ToJSON v) =&gt; Key -&gt; v -&gt; kv
</span><span class="hs-operator hs-var">.=</span></span><span> </span><span class="annot"><span class="annottext">Text -&gt; Value
</span><span class="hs-identifier hs-var">String</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a. Show a =&gt; a -&gt; Text
</span><span class="hs-identifier hs-var">showT</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679612453"><span class="hs-identifier hs-var">fsBlocksForgedNum</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-101"></span><span>             </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Key
</span><span class="hs-string">&quot;slotsMissed&quot;</span></span><span>        </span><span class="annot"><span class="annottext">forall kv v. (KeyValue kv, ToJSON v) =&gt; Key -&gt; v -&gt; kv
</span><span class="hs-operator hs-var">.=</span></span><span> </span><span class="annot"><span class="annottext">Text -&gt; Value
</span><span class="hs-identifier hs-var">String</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a. Show a =&gt; a -&gt; Text
</span><span class="hs-identifier hs-var">showT</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679612452"><span class="hs-identifier hs-var">fsSlotsMissedNum</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-102"></span><span>             </span><span class="hs-special">]</span><span>
</span><span id="line-103"></span><span>  </span><span id="local-6989586621679612439"><span class="annot"><span class="annottext">asMetrics :: ForgingStats -&gt; [Metric]
</span><a href="#local-6989586621679612439"><span class="hs-identifier hs-var hs-var hs-var hs-var">asMetrics</span></a></span></span><span> </span><span class="annot"><a href="Cardano.Node.Tracing.Tracers.ForgingThreadStats.html#ForgingStats"><span class="hs-identifier hs-type">ForgingStats</span></a></span><span> </span><span class="hs-special">{</span><span id="local-6989586621679612434"><span id="local-6989586621679612435"><span id="local-6989586621679612436"><span id="local-6989586621679612437"><span id="local-6989586621679612438"><span class="annot"><span class="annottext">Int
Map ThreadId ForgeThreadStats
fsSlotsMissedNum :: Int
fsBlocksForgedNum :: Int
fsNodeIsLeaderNum :: Int
fsNodeCannotForgeNum :: Int
fsStats :: Map ThreadId ForgeThreadStats
fsSlotsMissedNum :: ForgingStats -&gt; Int
fsBlocksForgedNum :: ForgingStats -&gt; Int
fsNodeIsLeaderNum :: ForgingStats -&gt; Int
fsNodeCannotForgeNum :: ForgingStats -&gt; Int
fsStats :: ForgingStats -&gt; Map ThreadId ForgeThreadStats
</span><a href="#local-6989586621679612434"><span class="hs-glyph hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">..</span></a></span></span></span></span></span></span><span class="hs-special">}</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-104"></span><span>    </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Text -&gt; Integer -&gt; Metric
</span><span class="hs-identifier hs-var">IntM</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;Forge.NodeCannotForgeNum&quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a b. (Integral a, Num b) =&gt; a -&gt; b
</span><a href="../file:///usr/local/.ghcup/ghc/9.2.7/share/doc/ghc-9.2.7/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-var">fromIntegral</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679612437"><span class="hs-identifier hs-var">fsNodeCannotForgeNum</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-105"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Text -&gt; Integer -&gt; Metric
</span><span class="hs-identifier hs-var">IntM</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;Forge.NodeIsLeaderNum&quot;</span></span><span>    </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a b. (Integral a, Num b) =&gt; a -&gt; b
</span><a href="../file:///usr/local/.ghcup/ghc/9.2.7/share/doc/ghc-9.2.7/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-var">fromIntegral</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679612436"><span class="hs-identifier hs-var">fsNodeIsLeaderNum</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-106"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Text -&gt; Integer -&gt; Metric
</span><span class="hs-identifier hs-var">IntM</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;Forge.BlocksForgedNum&quot;</span></span><span>    </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a b. (Integral a, Num b) =&gt; a -&gt; b
</span><a href="../file:///usr/local/.ghcup/ghc/9.2.7/share/doc/ghc-9.2.7/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-var">fromIntegral</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679612435"><span class="hs-identifier hs-var">fsBlocksForgedNum</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-107"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Text -&gt; Integer -&gt; Metric
</span><span class="hs-identifier hs-var">IntM</span></span><span> </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;Forge.SlotsMissed&quot;</span></span><span>        </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall a b. (Integral a, Num b) =&gt; a -&gt; b
</span><a href="../file:///usr/local/.ghcup/ghc/9.2.7/share/doc/ghc-9.2.7/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-var">fromIntegral</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679612434"><span class="hs-identifier hs-var">fsSlotsMissedNum</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-108"></span><span>    </span><span class="hs-special">]</span><span>
</span><span id="line-109"></span><span>
</span><span id="line-110"></span><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621679612428"><span id="local-6989586621679612430"><span class="annot"><span class="hs-identifier hs-type">MetaTrace</span></span><span> </span><span class="annot"><a href="Cardano.Node.Tracing.Tracers.ForgingThreadStats.html#ForgingStats"><span class="hs-identifier hs-type">ForgingStats</span></a></span></span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-111"></span><span>    </span><span id="local-6989586621679612422"><span class="annot"><span class="annottext">namespaceFor :: ForgingStats -&gt; Namespace ForgingStats
</span><span class="hs-identifier hs-var hs-var hs-var hs-var">namespaceFor</span></span></span><span> </span><span class="annot"><a href="Cardano.Node.Tracing.Tracers.ForgingThreadStats.html#ForgingStats"><span class="hs-identifier hs-type">ForgingStats</span></a></span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a. [Text] -&gt; [Text] -&gt; Namespace a
</span><span class="hs-identifier hs-var">Namespace</span></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;ForgingStats&quot;</span></span><span class="hs-special">]</span><span>
</span><span id="line-112"></span><span>
</span><span id="line-113"></span><span>    </span><span id="local-6989586621679612419"><span class="annot"><span class="annottext">severityFor :: Namespace ForgingStats -&gt; Maybe ForgingStats -&gt; Maybe SeverityS
</span><span class="hs-identifier hs-var hs-var hs-var hs-var">severityFor</span></span></span><span> </span><span class="annot"><span class="annottext">Namespace ForgingStats
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">Maybe ForgingStats
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a. a -&gt; Maybe a
</span><a href="../file:///usr/local/.ghcup/ghc/9.2.7/share/doc/ghc-9.2.7/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-var">Just</span></a></span><span> </span><span class="annot"><span class="annottext">SeverityS
</span><span class="hs-identifier hs-var">Info</span></span><span>
</span><span id="line-114"></span><span>
</span><span id="line-115"></span><span>    </span><span id="local-6989586621679612415"><span class="annot"><span class="annottext">documentFor :: Namespace ForgingStats -&gt; Maybe Text
</span><span class="hs-identifier hs-var hs-var hs-var hs-var">documentFor</span></span></span><span> </span><span class="annot"><span class="annottext">Namespace ForgingStats
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a. a -&gt; Maybe a
</span><a href="../file:///usr/local/.ghcup/ghc/9.2.7/share/doc/ghc-9.2.7/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-var">Just</span></a></span><span>
</span><span id="line-116"></span><span>      </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;nodeCannotForgeNum shows how many times this node could not forge.\
      \\nnodeIsLeaderNum shows how many times this node was leader.\
      \\nblocksForgedNum shows how many blocks did forge in this node.\
      \\nslotsMissed shows how many slots were missed in this node.&quot;</span></span><span>
</span><span id="line-120"></span><span>
</span><span id="line-121"></span><span>    </span><span id="local-6989586621679612403"><span class="annot"><span class="annottext">metricsDocFor :: Namespace ForgingStats -&gt; [(Text, Text)]
</span><span class="hs-identifier hs-var hs-var hs-var hs-var">metricsDocFor</span></span></span><span> </span><span class="annot"><span class="annottext">Namespace ForgingStats
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-122"></span><span>      </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;Forge.NodeCannotForgeNum&quot;</span></span><span class="hs-special">,</span><span>
</span><span id="line-123"></span><span>        </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;How many times this node could not forge?&quot;</span></span><span class="hs-special">)</span><span>
</span><span id="line-124"></span><span>      </span><span class="hs-special">,</span><span class="hs-special">(</span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;Forge.NodeIsLeaderNum&quot;</span></span><span class="hs-special">,</span><span>
</span><span id="line-125"></span><span>        </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;How many times this node was leader?&quot;</span></span><span class="hs-special">)</span><span>
</span><span id="line-126"></span><span>      </span><span class="hs-special">,</span><span class="hs-special">(</span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;Forge.BlocksForgedNum&quot;</span></span><span class="hs-special">,</span><span>
</span><span id="line-127"></span><span>        </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;How many blocks did forge in this node?&quot;</span></span><span class="hs-special">)</span><span>
</span><span id="line-128"></span><span>      </span><span class="hs-special">,</span><span class="hs-special">(</span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;Forge.SlotsMissed&quot;</span></span><span class="hs-special">,</span><span>
</span><span id="line-129"></span><span>        </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;How many slots were missed in this node?&quot;</span></span><span class="hs-special">)</span><span>
</span><span id="line-130"></span><span>      </span><span class="hs-special">,</span><span class="hs-special">(</span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;Forge.LastSlot&quot;</span></span><span class="hs-special">,</span><span>
</span><span id="line-131"></span><span>        </span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;&quot;</span></span><span class="hs-special">)</span><span>
</span><span id="line-132"></span><span>      </span><span class="hs-special">]</span><span>
</span><span id="line-133"></span><span>
</span><span id="line-134"></span><span>    </span><span id="local-6989586621679612400"><span class="annot"><span class="annottext">allNamespaces :: [Namespace ForgingStats]
</span><span class="hs-identifier hs-var hs-var hs-var hs-var">allNamespaces</span></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">forall a. [Text] -&gt; [Text] -&gt; Namespace a
</span><span class="hs-identifier hs-var">Namespace</span></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Text
</span><span class="hs-string">&quot;ForgingStats&quot;</span></span><span class="hs-special">]</span><span class="hs-special">]</span><span>
</span><span id="line-135"></span><span>
</span><span id="line-136"></span><span>
</span><span id="line-137"></span><span class="annot"><a href="Cardano.Node.Tracing.Tracers.ForgingThreadStats.html#emptyForgingStats"><span class="hs-identifier hs-type">emptyForgingStats</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Cardano.Node.Tracing.Tracers.ForgingThreadStats.html#ForgingStats"><span class="hs-identifier hs-type">ForgingStats</span></a></span><span>
</span><span id="line-138"></span><span id="emptyForgingStats"><span class="annot"><span class="annottext">emptyForgingStats :: ForgingStats
</span><a href="Cardano.Node.Tracing.Tracers.ForgingThreadStats.html#emptyForgingStats"><span class="hs-identifier hs-var hs-var">emptyForgingStats</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Map ThreadId ForgeThreadStats
-&gt; Int -&gt; Int -&gt; Int -&gt; Int -&gt; ForgingStats
</span><a href="Cardano.Node.Tracing.Tracers.ForgingThreadStats.html#ForgingStats"><span class="hs-identifier hs-var">ForgingStats</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Monoid a =&gt; a
</span><a href="../file:///usr/local/.ghcup/ghc/9.2.7/share/doc/ghc-9.2.7/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-var">mempty</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span>
</span><span id="line-139"></span><span>
</span><span id="line-140"></span><span id="local-6989586621679612673"><span class="annot"><a href="Cardano.Node.Tracing.Tracers.ForgingThreadStats.html#forgeThreadStats"><span class="hs-identifier hs-type">forgeThreadStats</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Trace</span></span><span> </span><span class="annot"><a href="../file:///usr/local/.ghcup/ghc/9.2.7/share/doc/ghc-9.2.7/html/libraries/ghc-prim-0.8.0/src"><span class="hs-identifier hs-type">IO</span></a></span><span> </span><span class="annot"><a href="Cardano.Node.Tracing.Tracers.ForgingThreadStats.html#ForgingStats"><span class="hs-identifier hs-type">ForgingStats</span></a></span><span>
</span><span id="line-141"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../file:///usr/local/.ghcup/ghc/9.2.7/share/doc/ghc-9.2.7/html/libraries/ghc-prim-0.8.0/src"><span class="hs-identifier hs-type">IO</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Trace</span></span><span> </span><span class="annot"><a href="../file:///usr/local/.ghcup/ghc/9.2.7/share/doc/ghc-9.2.7/html/libraries/ghc-prim-0.8.0/src"><span class="hs-identifier hs-type">IO</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Node.Tracing.Tracers.StartLeadershipCheck.html#ForgeTracerType"><span class="hs-identifier hs-type">ForgeTracerType</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679612673"><span class="hs-identifier hs-type">blk</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span></span><span>
</span><span id="line-142"></span><span id="forgeThreadStats"><span class="annot"><span class="annottext">forgeThreadStats :: forall blk.
Trace IO ForgingStats -&gt; IO (Trace IO (ForgeTracerType blk))
</span><a href="Cardano.Node.Tracing.Tracers.ForgingThreadStats.html#forgeThreadStats"><span class="hs-identifier hs-var hs-var">forgeThreadStats</span></a></span></span><span> </span><span id="local-6989586621679612393"><span class="annot"><span class="annottext">Trace IO ForgingStats
</span><a href="#local-6989586621679612393"><span class="hs-identifier hs-var">tr</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-143"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679612388"><span class="annot"><span class="annottext">tr' :: Trace IO (Folding a ForgingStats)
</span><a href="#local-6989586621679612388"><span class="hs-identifier hs-var hs-var">tr'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a' a.
Contravariant f =&gt;
(a' -&gt; a) -&gt; f a -&gt; f a'
</span><a href="../file:///usr/local/.ghcup/ghc/9.2.7/share/doc/ghc-9.2.7/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-var">contramap</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. Folding a b -&gt; b
</span><span class="hs-identifier hs-var">unfold</span></span><span> </span><span class="annot"><span class="annottext">Trace IO ForgingStats
</span><a href="#local-6989586621679612393"><span class="hs-identifier hs-var">tr</span></a></span><span>
</span><span id="line-144"></span><span>  </span><span class="hs-keyword">in</span><span> </span><span class="annot"><span class="annottext">forall a acc (m :: * -&gt; *).
MonadUnliftIO m =&gt;
(acc -&gt; LoggingContext -&gt; a -&gt; m acc)
-&gt; acc -&gt; (a -&gt; Bool) -&gt; Trace m (Folding a acc) -&gt; m (Trace m a)
</span><span class="hs-identifier hs-var">foldMCondTraceM</span></span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) blk.
MonadIO m =&gt;
ForgingStats
-&gt; LoggingContext -&gt; ForgeTracerType blk -&gt; m ForgingStats
</span><a href="Cardano.Node.Tracing.Tracers.ForgingThreadStats.html#calculateThreadStats"><span class="hs-identifier hs-var">calculateThreadStats</span></a></span><span> </span><span class="annot"><span class="annottext">ForgingStats
</span><a href="Cardano.Node.Tracing.Tracers.ForgingThreadStats.html#emptyForgingStats"><span class="hs-identifier hs-var">emptyForgingStats</span></a></span><span>
</span><span id="line-145"></span><span>      </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span class="hs-glyph">case</span><span>
</span><span id="line-146"></span><span>          </span><span class="annot"><a href="../file:///usr/local/.ghcup/ghc/9.2.7/share/doc/ghc-9.2.7/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-type">Left</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Consensus.TraceStartLeadershipCheck</span></span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="../file:///usr/local/.ghcup/ghc/9.2.7/share/doc/ghc-9.2.7/html/libraries/ghc-prim-0.8.0/src"><span class="hs-identifier hs-var">True</span></a></span><span>
</span><span id="line-147"></span><span>          </span><span class="annot"><a href="../file:///usr/local/.ghcup/ghc/9.2.7/share/doc/ghc-9.2.7/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-type">Left</span></a></span><span> </span><span class="annot"><span class="annottext">TraceForgeEvent blk
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="../file:///usr/local/.ghcup/ghc/9.2.7/share/doc/ghc-9.2.7/html/libraries/ghc-prim-0.8.0/src"><span class="hs-identifier hs-var">False</span></a></span><span>
</span><span id="line-148"></span><span>          </span><span class="annot"><a href="../file:///usr/local/.ghcup/ghc/9.2.7/share/doc/ghc-9.2.7/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-type">Right</span></a></span><span> </span><span class="annot"><span class="annottext">TraceStartLeadershipCheckPlus
</span><span class="hs-identifier">_</span></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="../file:///usr/local/.ghcup/ghc/9.2.7/share/doc/ghc-9.2.7/html/libraries/ghc-prim-0.8.0/src"><span class="hs-identifier hs-var">True</span></a></span><span>
</span><span id="line-149"></span><span>          </span><span class="hs-special">)</span><span>
</span><span id="line-150"></span><span>      </span><span class="annot"><span class="annottext">forall {a}. Trace IO (Folding a ForgingStats)
</span><a href="#local-6989586621679612388"><span class="hs-identifier hs-var">tr'</span></a></span><span>
</span><span id="line-151"></span><span>
</span><span id="line-152"></span><span id="local-6989586621679612655"><span id="local-6989586621679612656"><span class="annot"><a href="Cardano.Node.Tracing.Tracers.ForgingThreadStats.html#calculateThreadStats"><span class="hs-identifier hs-type">calculateThreadStats</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="../file:///usr/local/.ghcup/ghc/9.2.7/share/doc/ghc-9.2.7/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-type">MonadIO</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679612656"><span class="hs-identifier hs-type">m</span></a></span><span>
</span><span id="line-153"></span><span>  </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Cardano.Node.Tracing.Tracers.ForgingThreadStats.html#ForgingStats"><span class="hs-identifier hs-type">ForgingStats</span></a></span><span>
</span><span id="line-154"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">LoggingContext</span></span><span>
</span><span id="line-155"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Cardano.Node.Tracing.Tracers.StartLeadershipCheck.html#ForgeTracerType"><span class="hs-identifier hs-type">ForgeTracerType</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679612655"><span class="hs-identifier hs-type">blk</span></a></span><span>
</span><span id="line-156"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679612656"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="Cardano.Node.Tracing.Tracers.ForgingThreadStats.html#ForgingStats"><span class="hs-identifier hs-type">ForgingStats</span></a></span></span></span><span>
</span><span id="line-157"></span><span id="calculateThreadStats"><span class="annot"><span class="annottext">calculateThreadStats :: forall (m :: * -&gt; *) blk.
MonadIO m =&gt;
ForgingStats
-&gt; LoggingContext -&gt; ForgeTracerType blk -&gt; m ForgingStats
</span><a href="Cardano.Node.Tracing.Tracers.ForgingThreadStats.html#calculateThreadStats"><span class="hs-identifier hs-var hs-var">calculateThreadStats</span></a></span></span><span> </span><span id="local-6989586621679612351"><span class="annot"><span class="annottext">ForgingStats
</span><a href="#local-6989586621679612351"><span class="hs-identifier hs-var">stats</span></a></span></span><span> </span><span id="local-6989586621679612350"><span class="annot"><span class="annottext">LoggingContext
</span><a href="#local-6989586621679612350"><span class="hs-identifier hs-var">_context</span></a></span></span><span>
</span><span id="line-158"></span><span>    </span><span class="hs-special">(</span><span class="annot"><a href="../file:///usr/local/.ghcup/ghc/9.2.7/share/doc/ghc-9.2.7/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-type">Left</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">TraceNodeCannotForge</span></span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-159"></span><span>      </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a.
MonadIO m =&gt;
ForgingStats
-&gt; (ForgeThreadStats -&gt; (ForgeThreadStats, Maybe a))
-&gt; (ForgingStats -&gt; Maybe a -&gt; ForgingStats)
-&gt; m ForgingStats
</span><a href="Cardano.Node.Tracing.Tracers.ForgingThreadStats.html#mapThreadStats"><span class="hs-identifier hs-var">mapThreadStats</span></a></span><span>
</span><span id="line-160"></span><span>        </span><span class="annot"><span class="annottext">ForgingStats
</span><a href="#local-6989586621679612351"><span class="hs-identifier hs-var">stats</span></a></span><span>
</span><span id="line-161"></span><span>        </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621679612347"><span class="annot"><span class="annottext">ForgeThreadStats
</span><a href="#local-6989586621679612347"><span class="hs-identifier hs-var">fts</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ForgeThreadStats
</span><a href="#local-6989586621679612347"><span class="hs-identifier hs-var">fts</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">ftsNodeCannotForgeNum :: Int
</span><a href="Cardano.Node.Tracing.Tracers.ForgingThreadStats.html#ftsNodeCannotForgeNum"><span class="hs-identifier hs-var">ftsNodeCannotForgeNum</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ForgeThreadStats -&gt; Int
</span><a href="Cardano.Node.Tracing.Tracers.ForgingThreadStats.html#ftsNodeCannotForgeNum"><span class="hs-identifier hs-var">ftsNodeCannotForgeNum</span></a></span><span> </span><span class="annot"><span class="annottext">ForgeThreadStats
</span><a href="#local-6989586621679612347"><span class="hs-identifier hs-var">fts</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Num a =&gt; a -&gt; a -&gt; a
</span><a href="../file:///usr/local/.ghcup/ghc/9.2.7/share/doc/ghc-9.2.7/html/libraries/base-4.16.4.0/src"><span class="hs-operator hs-var">+</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span class="hs-special">}</span><span>
</span><span id="line-162"></span><span>                      </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">forall a. Maybe a
</span><a href="../file:///usr/local/.ghcup/ghc/9.2.7/share/doc/ghc-9.2.7/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-var">Nothing</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-163"></span><span>        </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621679612345"><span class="annot"><span class="annottext">ForgingStats
</span><a href="#local-6989586621679612345"><span class="hs-identifier hs-var">fs</span></a></span></span><span> </span><span class="annot"><span class="annottext">Maybe Any
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>  </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ForgingStats
</span><a href="#local-6989586621679612345"><span class="hs-identifier hs-var">fs</span></a></span><span>  </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">fsNodeCannotForgeNum :: Int
</span><a href="Cardano.Node.Tracing.Tracers.ForgingThreadStats.html#fsNodeCannotForgeNum"><span class="hs-identifier hs-var">fsNodeCannotForgeNum</span></a></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ForgingStats -&gt; Int
</span><a href="Cardano.Node.Tracing.Tracers.ForgingThreadStats.html#fsNodeCannotForgeNum"><span class="hs-identifier hs-var">fsNodeCannotForgeNum</span></a></span><span> </span><span class="annot"><span class="annottext">ForgingStats
</span><a href="#local-6989586621679612345"><span class="hs-identifier hs-var">fs</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Num a =&gt; a -&gt; a -&gt; a
</span><a href="../file:///usr/local/.ghcup/ghc/9.2.7/share/doc/ghc-9.2.7/html/libraries/base-4.16.4.0/src"><span class="hs-operator hs-var">+</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-164"></span><span class="annot"><a href="Cardano.Node.Tracing.Tracers.ForgingThreadStats.html#calculateThreadStats"><span class="hs-identifier hs-var">calculateThreadStats</span></a></span><span> </span><span id="local-6989586621679612344"><span class="annot"><span class="annottext">ForgingStats
</span><a href="#local-6989586621679612344"><span class="hs-identifier hs-var">stats</span></a></span></span><span> </span><span id="local-6989586621679612343"><span class="annot"><span class="annottext">LoggingContext
</span><a href="#local-6989586621679612343"><span class="hs-identifier hs-var">_context</span></a></span></span><span>
</span><span id="line-165"></span><span>    </span><span class="hs-special">(</span><span class="annot"><a href="../file:///usr/local/.ghcup/ghc/9.2.7/share/doc/ghc-9.2.7/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-type">Left</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">TraceNodeIsLeader</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">SlotNo</span></span><span> </span><span id="local-6989586621679612340"><span class="annot"><span class="annottext">Word64
</span><a href="#local-6989586621679612340"><span class="hs-identifier hs-var">slot'</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-166"></span><span>      </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679612336"><span class="annot"><span class="annottext">slot :: Int
</span><a href="#local-6989586621679612336"><span class="hs-identifier hs-var hs-var">slot</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a b. (Integral a, Num b) =&gt; a -&gt; b
</span><a href="../file:///usr/local/.ghcup/ghc/9.2.7/share/doc/ghc-9.2.7/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-var">fromIntegral</span></a></span><span> </span><span class="annot"><span class="annottext">Word64
</span><a href="#local-6989586621679612340"><span class="hs-identifier hs-var">slot'</span></a></span><span>
</span><span id="line-167"></span><span>      </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a.
MonadIO m =&gt;
ForgingStats
-&gt; (ForgeThreadStats -&gt; (ForgeThreadStats, Maybe a))
-&gt; (ForgingStats -&gt; Maybe a -&gt; ForgingStats)
-&gt; m ForgingStats
</span><a href="Cardano.Node.Tracing.Tracers.ForgingThreadStats.html#mapThreadStats"><span class="hs-identifier hs-var">mapThreadStats</span></a></span><span>
</span><span id="line-168"></span><span>        </span><span class="annot"><span class="annottext">ForgingStats
</span><a href="#local-6989586621679612344"><span class="hs-identifier hs-var">stats</span></a></span><span>
</span><span id="line-169"></span><span>        </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621679612335"><span class="annot"><span class="annottext">ForgeThreadStats
</span><a href="#local-6989586621679612335"><span class="hs-identifier hs-var">fts</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ForgeThreadStats
</span><a href="#local-6989586621679612335"><span class="hs-identifier hs-var">fts</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">ftsNodeIsLeaderNum :: Int
</span><a href="Cardano.Node.Tracing.Tracers.ForgingThreadStats.html#ftsNodeIsLeaderNum"><span class="hs-identifier hs-var">ftsNodeIsLeaderNum</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ForgeThreadStats -&gt; Int
</span><a href="Cardano.Node.Tracing.Tracers.ForgingThreadStats.html#ftsNodeIsLeaderNum"><span class="hs-identifier hs-var">ftsNodeIsLeaderNum</span></a></span><span> </span><span class="annot"><span class="annottext">ForgeThreadStats
</span><a href="#local-6989586621679612335"><span class="hs-identifier hs-var">fts</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Num a =&gt; a -&gt; a -&gt; a
</span><a href="../file:///usr/local/.ghcup/ghc/9.2.7/share/doc/ghc-9.2.7/html/libraries/base-4.16.4.0/src"><span class="hs-operator hs-var">+</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span>
</span><span id="line-170"></span><span>                   </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">ftsLastSlot :: Int
</span><a href="Cardano.Node.Tracing.Tracers.ForgingThreadStats.html#ftsLastSlot"><span class="hs-identifier hs-var">ftsLastSlot</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679612336"><span class="hs-identifier hs-var">slot</span></a></span><span class="hs-special">}</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">forall a. Maybe a
</span><a href="../file:///usr/local/.ghcup/ghc/9.2.7/share/doc/ghc-9.2.7/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-var">Nothing</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-171"></span><span>        </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621679612334"><span class="annot"><span class="annottext">ForgingStats
</span><a href="#local-6989586621679612334"><span class="hs-identifier hs-var">fs</span></a></span></span><span> </span><span class="annot"><span class="annottext">Maybe Any
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>  </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ForgingStats
</span><a href="#local-6989586621679612334"><span class="hs-identifier hs-var">fs</span></a></span><span>  </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">fsNodeIsLeaderNum :: Int
</span><a href="Cardano.Node.Tracing.Tracers.ForgingThreadStats.html#fsNodeIsLeaderNum"><span class="hs-identifier hs-var">fsNodeIsLeaderNum</span></a></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ForgingStats -&gt; Int
</span><a href="Cardano.Node.Tracing.Tracers.ForgingThreadStats.html#fsNodeIsLeaderNum"><span class="hs-identifier hs-var">fsNodeIsLeaderNum</span></a></span><span> </span><span class="annot"><span class="annottext">ForgingStats
</span><a href="#local-6989586621679612334"><span class="hs-identifier hs-var">fs</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Num a =&gt; a -&gt; a -&gt; a
</span><a href="../file:///usr/local/.ghcup/ghc/9.2.7/share/doc/ghc-9.2.7/html/libraries/base-4.16.4.0/src"><span class="hs-operator hs-var">+</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-172"></span><span class="annot"><a href="Cardano.Node.Tracing.Tracers.ForgingThreadStats.html#calculateThreadStats"><span class="hs-identifier hs-var">calculateThreadStats</span></a></span><span> </span><span id="local-6989586621679612333"><span class="annot"><span class="annottext">ForgingStats
</span><a href="#local-6989586621679612333"><span class="hs-identifier hs-var">stats</span></a></span></span><span> </span><span id="local-6989586621679612332"><span class="annot"><span class="annottext">LoggingContext
</span><a href="#local-6989586621679612332"><span class="hs-identifier hs-var">_context</span></a></span></span><span>
</span><span id="line-173"></span><span>    </span><span class="hs-special">(</span><span class="annot"><a href="../file:///usr/local/.ghcup/ghc/9.2.7/share/doc/ghc-9.2.7/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-type">Left</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">TraceForgedBlock</span></span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-174"></span><span>      </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a.
MonadIO m =&gt;
ForgingStats
-&gt; (ForgeThreadStats -&gt; (ForgeThreadStats, Maybe a))
-&gt; (ForgingStats -&gt; Maybe a -&gt; ForgingStats)
-&gt; m ForgingStats
</span><a href="Cardano.Node.Tracing.Tracers.ForgingThreadStats.html#mapThreadStats"><span class="hs-identifier hs-var">mapThreadStats</span></a></span><span>
</span><span id="line-175"></span><span>        </span><span class="annot"><span class="annottext">ForgingStats
</span><a href="#local-6989586621679612333"><span class="hs-identifier hs-var">stats</span></a></span><span>
</span><span id="line-176"></span><span>        </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621679612330"><span class="annot"><span class="annottext">ForgeThreadStats
</span><a href="#local-6989586621679612330"><span class="hs-identifier hs-var">fts</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ForgeThreadStats
</span><a href="#local-6989586621679612330"><span class="hs-identifier hs-var">fts</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">ftsBlocksForgedNum :: Int
</span><a href="Cardano.Node.Tracing.Tracers.ForgingThreadStats.html#ftsBlocksForgedNum"><span class="hs-identifier hs-var">ftsBlocksForgedNum</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ForgeThreadStats -&gt; Int
</span><a href="Cardano.Node.Tracing.Tracers.ForgingThreadStats.html#ftsBlocksForgedNum"><span class="hs-identifier hs-var">ftsBlocksForgedNum</span></a></span><span> </span><span class="annot"><span class="annottext">ForgeThreadStats
</span><a href="#local-6989586621679612330"><span class="hs-identifier hs-var">fts</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Num a =&gt; a -&gt; a -&gt; a
</span><a href="../file:///usr/local/.ghcup/ghc/9.2.7/share/doc/ghc-9.2.7/html/libraries/base-4.16.4.0/src"><span class="hs-operator hs-var">+</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span class="hs-special">}</span><span>
</span><span id="line-177"></span><span>                      </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">forall a. Maybe a
</span><a href="../file:///usr/local/.ghcup/ghc/9.2.7/share/doc/ghc-9.2.7/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-var">Nothing</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-178"></span><span>        </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621679612329"><span class="annot"><span class="annottext">ForgingStats
</span><a href="#local-6989586621679612329"><span class="hs-identifier hs-var">fs</span></a></span></span><span> </span><span class="annot"><span class="annottext">Maybe Any
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>  </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ForgingStats
</span><a href="#local-6989586621679612329"><span class="hs-identifier hs-var">fs</span></a></span><span>  </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">fsBlocksForgedNum :: Int
</span><a href="Cardano.Node.Tracing.Tracers.ForgingThreadStats.html#fsBlocksForgedNum"><span class="hs-identifier hs-var">fsBlocksForgedNum</span></a></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ForgingStats -&gt; Int
</span><a href="Cardano.Node.Tracing.Tracers.ForgingThreadStats.html#fsBlocksForgedNum"><span class="hs-identifier hs-var">fsBlocksForgedNum</span></a></span><span> </span><span class="annot"><span class="annottext">ForgingStats
</span><a href="#local-6989586621679612329"><span class="hs-identifier hs-var">fs</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Num a =&gt; a -&gt; a -&gt; a
</span><a href="../file:///usr/local/.ghcup/ghc/9.2.7/share/doc/ghc-9.2.7/html/libraries/base-4.16.4.0/src"><span class="hs-operator hs-var">+</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-179"></span><span class="annot"><a href="Cardano.Node.Tracing.Tracers.ForgingThreadStats.html#calculateThreadStats"><span class="hs-identifier hs-var">calculateThreadStats</span></a></span><span> </span><span id="local-6989586621679612328"><span class="annot"><span class="annottext">ForgingStats
</span><a href="#local-6989586621679612328"><span class="hs-identifier hs-var">stats</span></a></span></span><span> </span><span id="local-6989586621679612327"><span class="annot"><span class="annottext">LoggingContext
</span><a href="#local-6989586621679612327"><span class="hs-identifier hs-var">_context</span></a></span></span><span>
</span><span id="line-180"></span><span>    </span><span class="hs-special">(</span><span class="annot"><a href="../file:///usr/local/.ghcup/ghc/9.2.7/share/doc/ghc-9.2.7/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-type">Left</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">TraceNodeNotLeader</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">SlotNo</span></span><span> </span><span id="local-6989586621679612325"><span class="annot"><span class="annottext">Word64
</span><a href="#local-6989586621679612325"><span class="hs-identifier hs-var">slot'</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-181"></span><span>      </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679612322"><span class="annot"><span class="annottext">slot :: Int
</span><a href="#local-6989586621679612322"><span class="hs-identifier hs-var hs-var">slot</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall a b. (Integral a, Num b) =&gt; a -&gt; b
</span><a href="../file:///usr/local/.ghcup/ghc/9.2.7/share/doc/ghc-9.2.7/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-var">fromIntegral</span></a></span><span> </span><span class="annot"><span class="annottext">Word64
</span><a href="#local-6989586621679612325"><span class="hs-identifier hs-var">slot'</span></a></span><span>
</span><span id="line-182"></span><span>      </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a.
MonadIO m =&gt;
ForgingStats
-&gt; (ForgeThreadStats -&gt; (ForgeThreadStats, Maybe a))
-&gt; (ForgingStats -&gt; Maybe a -&gt; ForgingStats)
-&gt; m ForgingStats
</span><a href="Cardano.Node.Tracing.Tracers.ForgingThreadStats.html#mapThreadStats"><span class="hs-identifier hs-var">mapThreadStats</span></a></span><span>
</span><span id="line-183"></span><span>        </span><span class="annot"><span class="annottext">ForgingStats
</span><a href="#local-6989586621679612328"><span class="hs-identifier hs-var">stats</span></a></span><span>
</span><span id="line-184"></span><span>        </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621679612321"><span class="annot"><span class="annottext">ForgeThreadStats
</span><a href="#local-6989586621679612321"><span class="hs-identifier hs-var">fts</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-185"></span><span>          </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">ForgeThreadStats -&gt; Int
</span><a href="Cardano.Node.Tracing.Tracers.ForgingThreadStats.html#ftsLastSlot"><span class="hs-identifier hs-var">ftsLastSlot</span></a></span><span> </span><span class="annot"><span class="annottext">ForgeThreadStats
</span><a href="#local-6989586621679612321"><span class="hs-identifier hs-var">fts</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><a href="../file:///usr/local/.ghcup/ghc/9.2.7/share/doc/ghc-9.2.7/html/libraries/ghc-prim-0.8.0/src"><span class="hs-operator hs-var">==</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><a href="../file:///usr/local/.ghcup/ghc/9.2.7/share/doc/ghc-9.2.7/html/libraries/ghc-prim-0.8.0/src"><span class="hs-operator hs-var">||</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Enum a =&gt; a -&gt; a
</span><a href="../file:///usr/local/.ghcup/ghc/9.2.7/share/doc/ghc-9.2.7/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-var">succ</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ForgeThreadStats -&gt; Int
</span><a href="Cardano.Node.Tracing.Tracers.ForgingThreadStats.html#ftsLastSlot"><span class="hs-identifier hs-var">ftsLastSlot</span></a></span><span> </span><span class="annot"><span class="annottext">ForgeThreadStats
</span><a href="#local-6989586621679612321"><span class="hs-identifier hs-var">fts</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><a href="../file:///usr/local/.ghcup/ghc/9.2.7/share/doc/ghc-9.2.7/html/libraries/ghc-prim-0.8.0/src"><span class="hs-operator hs-var">==</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679612322"><span class="hs-identifier hs-var">slot</span></a></span><span>
</span><span id="line-186"></span><span>            </span><span class="hs-keyword">then</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ForgeThreadStats
</span><a href="#local-6989586621679612321"><span class="hs-identifier hs-var">fts</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">ftsLastSlot :: Int
</span><a href="Cardano.Node.Tracing.Tracers.ForgingThreadStats.html#ftsLastSlot"><span class="hs-identifier hs-var">ftsLastSlot</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679612322"><span class="hs-identifier hs-var">slot</span></a></span><span> </span><span class="hs-special">}</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">forall a. Maybe a
</span><a href="../file:///usr/local/.ghcup/ghc/9.2.7/share/doc/ghc-9.2.7/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-var">Nothing</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-187"></span><span>            </span><span class="hs-keyword">else</span><span>
</span><span id="line-188"></span><span>              </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679612317"><span class="annot"><span class="annottext">missed :: Int
</span><a href="#local-6989586621679612317"><span class="hs-identifier hs-var hs-var">missed</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679612322"><span class="hs-identifier hs-var">slot</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Num a =&gt; a -&gt; a -&gt; a
</span><a href="../file:///usr/local/.ghcup/ghc/9.2.7/share/doc/ghc-9.2.7/html/libraries/base-4.16.4.0/src"><span class="hs-glyph hs-var">-</span></a></span><span> </span><span class="annot"><span class="annottext">ForgeThreadStats -&gt; Int
</span><a href="Cardano.Node.Tracing.Tracers.ForgingThreadStats.html#ftsLastSlot"><span class="hs-identifier hs-var">ftsLastSlot</span></a></span><span> </span><span class="annot"><span class="annottext">ForgeThreadStats
</span><a href="#local-6989586621679612321"><span class="hs-identifier hs-var">fts</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-189"></span><span>              </span><span class="hs-keyword">in</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ForgeThreadStats
</span><a href="#local-6989586621679612321"><span class="hs-identifier hs-var">fts</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">ftsLastSlot :: Int
</span><a href="Cardano.Node.Tracing.Tracers.ForgingThreadStats.html#ftsLastSlot"><span class="hs-identifier hs-var">ftsLastSlot</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679612322"><span class="hs-identifier hs-var">slot</span></a></span><span>
</span><span id="line-190"></span><span>                      </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">ftsSlotsMissedNum :: Int
</span><a href="Cardano.Node.Tracing.Tracers.ForgingThreadStats.html#ftsSlotsMissedNum"><span class="hs-identifier hs-var">ftsSlotsMissedNum</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ForgeThreadStats -&gt; Int
</span><a href="Cardano.Node.Tracing.Tracers.ForgingThreadStats.html#ftsSlotsMissedNum"><span class="hs-identifier hs-var">ftsSlotsMissedNum</span></a></span><span> </span><span class="annot"><span class="annottext">ForgeThreadStats
</span><a href="#local-6989586621679612321"><span class="hs-identifier hs-var">fts</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Num a =&gt; a -&gt; a -&gt; a
</span><a href="../file:///usr/local/.ghcup/ghc/9.2.7/share/doc/ghc-9.2.7/html/libraries/base-4.16.4.0/src"><span class="hs-operator hs-var">+</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679612317"><span class="hs-identifier hs-var">missed</span></a></span><span class="hs-special">}</span><span>
</span><span id="line-191"></span><span>                 </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">forall a. a -&gt; Maybe a
</span><a href="../file:///usr/local/.ghcup/ghc/9.2.7/share/doc/ghc-9.2.7/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-var">Just</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679612317"><span class="hs-identifier hs-var">missed</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-192"></span><span>        </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621679612316"><span class="annot"><span class="annottext">ForgingStats
</span><a href="#local-6989586621679612316"><span class="hs-identifier hs-var">fs</span></a></span></span><span> </span><span id="local-6989586621679612315"><span class="annot"><span class="annottext">Maybe Int
</span><a href="#local-6989586621679612315"><span class="hs-identifier hs-var">mbMissed</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Maybe Int
</span><a href="#local-6989586621679612315"><span class="hs-identifier hs-var">mbMissed</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-193"></span><span>                            </span><span class="annot"><span class="annottext">Maybe Int
</span><a href="../file:///usr/local/.ghcup/ghc/9.2.7/share/doc/ghc-9.2.7/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-var">Nothing</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">ForgingStats
</span><a href="#local-6989586621679612316"><span class="hs-identifier hs-var">fs</span></a></span><span>
</span><span id="line-194"></span><span>                            </span><span class="annot"><a href="../file:///usr/local/.ghcup/ghc/9.2.7/share/doc/ghc-9.2.7/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span id="local-6989586621679612314"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679612314"><span class="hs-identifier hs-var">missed</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ForgingStats
</span><a href="#local-6989586621679612316"><span class="hs-identifier hs-var">fs</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">fsSlotsMissedNum :: Int
</span><a href="Cardano.Node.Tracing.Tracers.ForgingThreadStats.html#fsSlotsMissedNum"><span class="hs-identifier hs-var">fsSlotsMissedNum</span></a></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-195"></span><span>                              </span><span class="annot"><span class="annottext">ForgingStats -&gt; Int
</span><a href="Cardano.Node.Tracing.Tracers.ForgingThreadStats.html#fsSlotsMissedNum"><span class="hs-identifier hs-var">fsSlotsMissedNum</span></a></span><span> </span><span class="annot"><span class="annottext">ForgingStats
</span><a href="#local-6989586621679612316"><span class="hs-identifier hs-var">fs</span></a></span><span> </span><span class="annot"><span class="annottext">forall a. Num a =&gt; a -&gt; a -&gt; a
</span><a href="../file:///usr/local/.ghcup/ghc/9.2.7/share/doc/ghc-9.2.7/html/libraries/base-4.16.4.0/src"><span class="hs-operator hs-var">+</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621679612314"><span class="hs-identifier hs-var">missed</span></a></span><span class="hs-special">}</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-196"></span><span class="annot"><a href="Cardano.Node.Tracing.Tracers.ForgingThreadStats.html#calculateThreadStats"><span class="hs-identifier hs-var">calculateThreadStats</span></a></span><span> </span><span id="local-6989586621679612313"><span class="annot"><span class="annottext">ForgingStats
</span><a href="#local-6989586621679612313"><span class="hs-identifier hs-var">stats</span></a></span></span><span> </span><span id="local-6989586621679612312"><span class="annot"><span class="annottext">LoggingContext
</span><a href="#local-6989586621679612312"><span class="hs-identifier hs-var">_context</span></a></span></span><span> </span><span id="local-6989586621679612311"><span class="annot"><span class="annottext">Either (TraceForgeEvent blk) TraceStartLeadershipCheckPlus
</span><a href="#local-6989586621679612311"><span class="hs-identifier hs-var">_message</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="../file:///usr/local/.ghcup/ghc/9.2.7/share/doc/ghc-9.2.7/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="annot"><span class="annottext">ForgingStats
</span><a href="#local-6989586621679612313"><span class="hs-identifier hs-var">stats</span></a></span><span>
</span><span id="line-197"></span><span>
</span><span id="line-198"></span><span id="local-6989586621679612646"><span id="local-6989586621679612647"><span class="annot"><a href="Cardano.Node.Tracing.Tracers.ForgingThreadStats.html#mapThreadStats"><span class="hs-identifier hs-type">mapThreadStats</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-199"></span><span>     </span><span class="annot"><a href="../file:///usr/local/.ghcup/ghc/9.2.7/share/doc/ghc-9.2.7/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-type">MonadIO</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679612647"><span class="hs-identifier hs-type">m</span></a></span><span>
</span><span id="line-200"></span><span>  </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Cardano.Node.Tracing.Tracers.ForgingThreadStats.html#ForgingStats"><span class="hs-identifier hs-type">ForgingStats</span></a></span><span>
</span><span id="line-201"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Node.Tracing.Tracers.ForgingThreadStats.html#ForgeThreadStats"><span class="hs-identifier hs-type">ForgeThreadStats</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Node.Tracing.Tracers.ForgingThreadStats.html#ForgeThreadStats"><span class="hs-identifier hs-type">ForgeThreadStats</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../file:///usr/local/.ghcup/ghc/9.2.7/share/doc/ghc-9.2.7/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-type">Maybe</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679612646"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-202"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Cardano.Node.Tracing.Tracers.ForgingThreadStats.html#ForgingStats"><span class="hs-identifier hs-type">ForgingStats</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../file:///usr/local/.ghcup/ghc/9.2.7/share/doc/ghc-9.2.7/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-type">Maybe</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679612646"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Cardano.Node.Tracing.Tracers.ForgingThreadStats.html#ForgingStats"><span class="hs-identifier hs-type">ForgingStats</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-203"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679612647"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="Cardano.Node.Tracing.Tracers.ForgingThreadStats.html#ForgingStats"><span class="hs-identifier hs-type">ForgingStats</span></a></span></span></span><span>
</span><span id="line-204"></span><span id="mapThreadStats"><span class="annot"><span class="annottext">mapThreadStats :: forall (m :: * -&gt; *) a.
MonadIO m =&gt;
ForgingStats
-&gt; (ForgeThreadStats -&gt; (ForgeThreadStats, Maybe a))
-&gt; (ForgingStats -&gt; Maybe a -&gt; ForgingStats)
-&gt; m ForgingStats
</span><a href="Cardano.Node.Tracing.Tracers.ForgingThreadStats.html#mapThreadStats"><span class="hs-identifier hs-var hs-var">mapThreadStats</span></a></span></span><span> </span><span id="local-6989586621679612303"><span class="annot"><span class="annottext">fs :: ForgingStats
</span><a href="#local-6989586621679612303"><span class="hs-identifier hs-var">fs</span></a></span></span><span class="hs-glyph">@</span><span class="annot"><a href="Cardano.Node.Tracing.Tracers.ForgingThreadStats.html#ForgingStats"><span class="hs-identifier hs-type">ForgingStats</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621679612302"><span class="annot"><span class="annottext">Map ThreadId ForgeThreadStats
fsStats :: Map ThreadId ForgeThreadStats
fsStats :: ForgingStats -&gt; Map ThreadId ForgeThreadStats
</span><a href="#local-6989586621679612302"><span class="hs-identifier hs-var hs-var">fsStats</span></a></span></span><span> </span><span class="hs-special">}</span><span> </span><span id="local-6989586621679612301"><span class="annot"><span class="annottext">ForgeThreadStats -&gt; (ForgeThreadStats, Maybe a)
</span><a href="#local-6989586621679612301"><span class="hs-identifier hs-var">f1</span></a></span></span><span> </span><span id="local-6989586621679612300"><span class="annot"><span class="annottext">ForgingStats -&gt; Maybe a -&gt; ForgingStats
</span><a href="#local-6989586621679612300"><span class="hs-identifier hs-var">f2</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-205"></span><span>  </span><span id="local-6989586621679612299"><span class="annot"><span class="annottext">ThreadId
</span><a href="#local-6989586621679612299"><span class="hs-identifier hs-var">tid</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><a href="../file:///usr/local/.ghcup/ghc/9.2.7/share/doc/ghc-9.2.7/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-var">liftIO</span></a></span><span> </span><span class="annot"><span class="annottext">IO ThreadId
</span><a href="../file:///usr/local/.ghcup/ghc/9.2.7/share/doc/ghc-9.2.7/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-var">myThreadId</span></a></span><span>
</span><span id="line-206"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679612296"><span class="annot"><span class="annottext">threadStats :: ForgeThreadStats
</span><a href="#local-6989586621679612296"><span class="hs-identifier hs-var hs-var">threadStats</span></a></span></span><span>   </span><span class="hs-glyph">=</span><span>  </span><span class="annot"><span class="annottext">forall a. a -&gt; Maybe a -&gt; a
</span><a href="../file:///usr/local/.ghcup/ghc/9.2.7/share/doc/ghc-9.2.7/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-var">fromMaybe</span></a></span><span> </span><span class="annot"><span class="annottext">ForgeThreadStats
</span><a href="Cardano.Node.Tracing.Tracers.ForgingThreadStats.html#emptyForgeThreadStats"><span class="hs-identifier hs-var">emptyForgeThreadStats</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">forall k a. Ord k =&gt; k -&gt; Map k a -&gt; Maybe a
</span><a href="../file:///usr/local/.ghcup/ghc/9.2.7/share/doc/ghc-9.2.7/html/libraries/containers-0.6.5.1/src"><span class="hs-identifier hs-var">Map.lookup</span></a></span><span> </span><span class="annot"><span class="annottext">ThreadId
</span><a href="#local-6989586621679612299"><span class="hs-identifier hs-var">tid</span></a></span><span> </span><span class="annot"><span class="annottext">Map ThreadId ForgeThreadStats
</span><a href="#local-6989586621679612302"><span class="hs-identifier hs-var">fsStats</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-207"></span><span>      </span><span class="hs-special">(</span><span id="local-6989586621679612294"><span class="annot"><span class="annottext">ForgeThreadStats
</span><a href="#local-6989586621679612294"><span class="hs-identifier hs-var">newStats</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679612293"><span class="annot"><span class="annottext">Maybe a
</span><a href="#local-6989586621679612293"><span class="hs-identifier hs-var">w</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ForgeThreadStats -&gt; (ForgeThreadStats, Maybe a)
</span><a href="#local-6989586621679612301"><span class="hs-identifier hs-var">f1</span></a></span><span> </span><span class="annot"><span class="annottext">ForgeThreadStats
</span><a href="#local-6989586621679612296"><span class="hs-identifier hs-var">threadStats</span></a></span><span>
</span><span id="line-208"></span><span>  </span><span class="annot"><span class="annottext">forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="../file:///usr/local/.ghcup/ghc/9.2.7/share/doc/ghc-9.2.7/html/libraries/base-4.16.4.0/src"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="annot"><span class="annottext">forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../file:///usr/local/.ghcup/ghc/9.2.7/share/doc/ghc-9.2.7/html/libraries/base-4.16.4.0/src"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">ForgingStats -&gt; Maybe a -&gt; ForgingStats
</span><a href="#local-6989586621679612300"><span class="hs-identifier hs-var">f2</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ForgingStats
</span><a href="#local-6989586621679612303"><span class="hs-identifier hs-var">fs</span></a></span><span> </span><span class="hs-special">{</span><span class="annot"><span class="annottext">fsStats :: Map ThreadId ForgeThreadStats
</span><a href="Cardano.Node.Tracing.Tracers.ForgingThreadStats.html#fsStats"><span class="hs-identifier hs-var">fsStats</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">forall k a. Ord k =&gt; k -&gt; a -&gt; Map k a -&gt; Map k a
</span><a href="../file:///usr/local/.ghcup/ghc/9.2.7/share/doc/ghc-9.2.7/html/libraries/containers-0.6.5.1/src"><span class="hs-identifier hs-var">Map.insert</span></a></span><span> </span><span class="annot"><span class="annottext">ThreadId
</span><a href="#local-6989586621679612299"><span class="hs-identifier hs-var">tid</span></a></span><span> </span><span class="annot"><span class="annottext">ForgeThreadStats
</span><a href="#local-6989586621679612294"><span class="hs-identifier hs-var">newStats</span></a></span><span> </span><span class="annot"><span class="annottext">Map ThreadId ForgeThreadStats
</span><a href="#local-6989586621679612302"><span class="hs-identifier hs-var">fsStats</span></a></span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Maybe a
</span><a href="#local-6989586621679612293"><span class="hs-identifier hs-var">w</span></a></span><span>
</span><span id="line-209"></span></pre></body></html>